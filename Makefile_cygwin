CC 		= 	icl -Qlocation,link,"${VCINSTALLDIR}\bin" -Qstd=c99

EXEC 	= 	frac.exe

C_SOURCES 	= 	main.c frac.c generate_binary.c generate_mass.c get_wtime.c getopt.c make_mass.c mempool.c output.c quick_sort.c quick_select.c randomz.c randqueue.c scale.c
#C_OBJS 		= 	$(patsubst %.c, %.o, $(C_SOURCES))
C_OBJS 		= 	$(C_SOURCES:%.c=%.o)
C_DEPS 		= 	$(C_SOURCES:%.c=%.d)

OBJS 		= 	$(C_OBJS)
DEPS 		= 	$(C_DEPS)
INCL 		= 	type.h func.h constant.h Makefile

CFLAGS 		= 	-W -Wall -O3 -Qopenmp #-fast
LDFLAGS 	= 	-Qopenmp

$(EXEC) 	: 	$(OBJS) Makefile
	$(CC) /Fe$(EXEC) $(OBJS) $(LDFLAGS)

$(C_OBJS) : %.o : %.c Makefile
	$(CC) $(CFLAGS) -c /Fo$@ $<

-include $(DEPS)

$(C_DEPS) : %.d : %.c
	@set -e; rm -f $@; \
		$(CC) /QMMD $< > $@.$$$$; \
		sed 's/\($*\)\.o[ :]*/\1.o $@ : /g' < $@.$$$$ > $@; \
		rm -f $@.$$$$

.PHONY 			: 	clean
clean:
	-rm -f $(OBJS) $(DEPS) $(EXEC)
